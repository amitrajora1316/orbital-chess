<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>VANGUARD: ORBITAL CHESS</title>
    <style>
        :root { --bg: #020204; --panel: #0a0a0f; --accent: #d4af37; --text: #d2d2dc; }
        body { margin: 0; background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; display: flex; height: 100vh; overflow: hidden; }
        
        #sidebar { width: 320px; background: var(--panel); padding: 25px; border-right: 1px solid #2a2a35; display: flex; flex-direction: column; }
        .timer-box { background: #11111d; padding: 15px; border-radius: 4px; border: 1px solid #d4af3733; margin-bottom: 15px; }
        .fuel-bar { height: 4px; background: #1a1a25; margin-top: 8px; }
        .fuel-fill { height: 100%; transition: width 0.1s linear; }

        /* Overlays */
        #overlay, #victory-overlay { 
            position: absolute; top:0; left:0; width:100%; height:100%; 
            background: rgba(2,2,4,0.98); display: flex; flex-direction: column; 
            justify-content: center; align-items: center; z-index: 1000; text-align: center; 
        }
        #victory-overlay { display: none; background: rgba(2,2,4,0.9); }
        
        .btn { background: none; border: 1px solid var(--accent); color: var(--accent); padding: 12px 30px; margin: 10px; cursor: pointer; letter-spacing: 3px; }
        .btn:hover { background: var(--accent); color: #000; }
        #move-log { flex-grow: 1; background: #050508; padding: 12px; font-family: monospace; font-size: 0.7rem; overflow-y: auto; color: #666; }
    </style>
</head>
<body>

<div id="overlay">
    <h1 style="letter-spacing: 12px; color: var(--accent);">VANGUARD</h1>
    <div id="lang-btns">
        <button class="btn" onclick="setLang('en')">ENGLISH</button>
        <button class="btn" onclick="setLang('de')">DEUTSCH</button>
    </div>
    <div id="side-selection" style="display:none;">
        <button class="btn" id="btn-w" onclick="startGame('w')">WHITE (BOTTOM)</button>
        <button class="btn" id="btn-b" onclick="startGame('b')">BLACK (BOTTOM)</button>
    </div>
</div>

<div id="victory-overlay">
    <h1 id="victory-title" style="letter-spacing: 8px; color: var(--accent);">MISSION ACCOMPLISHED</h1>
    <p id="victory-msg" style="margin-bottom: 30px;"></p>
    <button class="btn" onclick="location.reload()">RESTART SYSTEM</button>
</div>

<div id="sidebar">
    <h1 id="ui-title" style="font-size: .8rem; letter-spacing: 6px; color: var(--accent); text-align: center; margin-bottom: 20px;">TACTICAL HUB</h1>
    <div id="turn-prompt" style="color:var(--accent); text-align:center; margin-bottom:10px; font-weight:bold; display:none;">YOUR TURN</div>
    <div class="timer-box">
        <div style="display:flex; justify-content: space-between; font-size: 0.65rem;"><span id="ui-wf">WHITE FUEL</span> <span id="tw-val">60.0s</span></div>
        <div class="fuel-bar"><div id="bw-fill" class="fuel-fill" style="background: var(--accent); width: 100%;"></div></div>
        <div style="display:flex; justify-content: space-between; font-size: 0.65rem; margin-top: 12px;"><span id="ui-bf">BLACK FUEL</span> <span id="tb-val">60.0s</span></div>
        <div class="fuel-bar"><div id="bb-fill" class="fuel-fill" style="background: #7a7a9a; width: 100%;"></div></div>
    </div>
    <div id="move-log"></div>
</div>

<canvas id="gameCanvas"></canvas>

<script>
// --- CONFIGURATION & GLOBALS ---
const ROWS = 8, COLS = 16, CELL = 80;
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const PIECES = { wK:'♔', wQ:'♕', wR:'♖', wB:'♗', wN:'♘', wP:'♙', bK:'♚', bQ:'♛', bR:'♜', bB:'♝', bN:'♞', bP:'♟' };
const VALS = { 'P': 10, 'N': 32, 'B': 33, 'R': 50, 'Q': 90, 'K': 1000 };
const TEXTS = {
    en: { title: "TACTICAL HUB", wf: "WHITE FUEL", bf: "BLACK FUEL", btnW: "WHITE (BOTTOM)", btnB: "BLACK (BOTTOM)", turn: "YOUR TURN", win: "ARENA SECURED", loss: "CRITICAL FAILURE", restart: "SYSTEM REBOOT" },
    de: { title: "TAKTIK-ZENTRALE", wf: "WEISS ENERGIE", bf: "SCHWARZ ENERGIE", btnW: "WEISS (UNTEN)", btnB: "SCHWARZ (UNTEN)", turn: "DU BIST DRAN", win: "ARENA GESICHERT", loss: "SYSTEMFEHLER", restart: "SYSTEM-NEUSTART" }
};

let curLang = 'en', board, turn = 'w', playerColor = 'w', selected = null, gameActive = false, validMoves = [];
let fuel = { w: 60, b: 60 }, lastTick = 0, cam = { x: 50, y: 50 };

// --- MENU & LANGUAGE LOGIC ---
function setLang(l) {
    curLang = l;
    const t = TEXTS[l];
    document.getElementById('ui-title').innerText = t.title;
    document.getElementById('ui-wf').innerText = t.wf;
    document.getElementById('ui-bf').innerText = t.bf;
    document.getElementById('btn-w').innerText = t.btnW;
    document.getElementById('btn-b').innerText = t.btnB;
    document.querySelector('#victory-overlay .btn').innerText = t.restart;
    document.getElementById('lang-btns').style.display = 'none';
    document.getElementById('side-selection').style.display = 'block';
}

function startGame(side) {
    playerColor = side;
    document.getElementById('overlay').style.display = 'none';
    gameActive = true;
    initBoard();
    lastTick = Date.now();
    updateHUD();
    if (playerColor === 'b') setTimeout(aiMove, 800);
    requestAnimationFrame(updateTimer);
}

// --- CORE ENGINE ---
function initBoard() {
    board = Array(ROWS).fill(null).map(() => Array(COLS).fill(''));
    const layout = ['R','N','B','Q','K','B','N','R'];
    for (let i = 0; i < 8; i++) {
        let col = i + 4;
        board[0][col] = 'bP'; board[1][col] = 'b' + layout[i]; board[2][col] = 'bP';
        board[7][col] = 'wP'; board[6][col] = 'w' + layout[i]; board[5][col] = 'wP';
    }
}

function endGame(winner, reason) {
    gameActive = false;
    const t = TEXTS[curLang];
    document.getElementById('victory-overlay').style.display = 'flex';
    document.getElementById('victory-title').innerText = (winner === playerColor) ? t.win : t.loss;
    document.getElementById('victory-msg').innerText = reason;
}

function executeMove(from, to) {
    if (!gameActive) return;
    const p = board[from.r][from.c];
    if (board[to.r][to.c] && board[to.r][to.c][1] === 'K') {
        board[to.r][to.c] = p; board[from.r][from.c] = '';
        endGame(turn, "Target King Neutralized"); return;
    }
    fuel[turn] = Math.min(60, fuel[turn] + 10);
    board[to.r][to.c] = p; board[from.r][from.c] = '';
    document.getElementById('move-log').innerHTML = `<div>> ${p[1]} ${from.r}:${from.c} to ${to.r}:${to.c}</div>` + document.getElementById('move-log').innerHTML;
    turn = turn === 'w' ? 'b' : 'w';
    updateHUD();
    if (gameActive && turn !== playerColor) setTimeout(aiMove, 600);
}

// --- TACTICAL AI ---
function aiMove() {
    if (!gameActive) return;
    const aiCol = playerColor === 'w' ? 'b' : 'w';
    let moves = [];
    for(let r=0; r<ROWS; r++) {
        for(let c=0; c<COLS; c++)
