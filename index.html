<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>VANGUARD: ORBITAL ARENA</title>
    <style>
        :root {
            --bg: #080812;
            --panel: #141423;
            --accent: #d4af37;
            --text: #d2d2dc;
        }
        body {
            margin: 0; background: var(--bg); color: var(--text);
            font-family: 'Consolas', monospace; display: flex; height: 100vh; overflow: hidden;
        }
        #sidebar {
            width: 300px; background: var(--panel); padding: 20px;
            display: flex; flex-direction: column; border-right: 2px solid #2a2a35;
        }
        #canvas-container { flex-grow: 1; display: flex; justify-content: center; align-items: center; cursor: crosshair; }
        .stat-box { background: #1a1a2d; padding: 15px; border-radius: 5px; margin-bottom: 20px; border: 1px solid #323246; }
        .fuel-bar { height: 10px; background: #28283c; border-radius: 5px; overflow: hidden; margin-top: 5px; }
        .fuel-fill { height: 100%; width: 100%; transition: width 0.3s; }
        .controls { font-size: 0.8rem; color: #8c8ca0; line-height: 1.6; }
        #victory-msg {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9); padding: 40px; border: 2px solid var(--accent);
            text-align: center; display: none; z-index: 100;
        }
    </style>
</head>
<body>

<div id="sidebar">
    <h2 style="color: var(--accent); letter-spacing: 2px;">VANGUARD V4</h2>
    <div class="stat-box">
        <div id="turn-label">AM ZUG: WEISS</div>
        <div style="margin-top:10px;">WEISS TREIBSTOFF: <span id="fw-val">60</span>s</div>
        <div class="fuel-bar"><div id="fw-bar" class="fuel-fill" style="background: var(--accent);"></div></div>
        <div style="margin-top:10px;">SCHWARZ TREIBSTOFF: <span id="fb-val">60</span>s</div>
        <div class="fuel-bar"><div id="fb-bar" class="fuel-fill" style="background: #ff3232;"></div></div>
    </div>
    <div class="controls">
        <b>STEUERUNG:</b><br>
        LINKSKLICK: Ziehen / Auswählen<br>
        RECHTSKLICK: Kamera schwenken<br>
        LEERTASTE: Zentrieren<br>
        R: Neustart
    </div>
</div>

<div id="canvas-container">
    <canvas id="gameCanvas"></canvas>
</div>

<div id="victory-msg">
    <h1 id="winner-text">SIEG!</h1>
    <button onclick="location.reload()" style="background: var(--accent); border:none; padding:10px 20px; cursor:pointer;">NEUSTART</button>
</div>

<script>
const ROWS = 8, COLS = 16, CELL = 70;
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

let board, turn, selected = null, gameActive = true;
let fuel = { w: 60, b: 60 };
let cam = { x: 50, y: 50 }, isPanning = false;

const PIECES = {
    wK:'♔', wQ:'♕', wR:'♖', wB:'♗', wN:'♘', wP:'♙',
    bK:'♚', bQ:'♛', bR:'♜', bB:'♝', bN:'♞', bP:'♟'
};

function initBoard() {
    board = Array(ROWS).fill(null).map(() => Array(COLS).fill(''));
    const layout = ['R','N','B','Q','K','B','N','R'];
    
    // Position pieces centered (Cols 4-11)
    for (let i = 0; i < 8; i++) {
        let col = i + 4;
        // White Army (Rows 5, 6, 7)
        board[7][col] = 'wP'; // Back Pawn
        board[6][col] = 'w' + layout[i]; // Main Piece
        board[5][col] = 'wP'; // Front Pawn
        
        // Black Army (Rows 0, 1, 2)
        board[0][col] = 'bP'; // Back Pawn
        board[1][col] = 'b' + layout[i]; // Main Piece
        board[2][col] = 'bP'; // Front Pawn
    }
}

function getMoves(r, c) {
    const p = board[r][c];
    if (!p) return [];
    const type = p[1], col = p[0], moves = [];
    
    if (type === 'P') {
        const fwd = col === 'w' ? -1 : 1;
        const nr = (r + fwd + ROWS) % ROWS;
        if (!board[nr][c]) moves.push({r: nr, c: c});
        [-1, 1].forEach(dc => {
            const nc = (c + dc + COLS) % COLS;
            if (board[nr][nc] && board[nr][nc][0] !== col) moves.push({r: nr, c: nc});
        });
    } else {
        const dirs = {
            'R':[[0,1],[0,-1],[1,0],[-1,0]],
            'B':[[1,1],[1,-1],[-1,1],[-1,-1]],
            'Q':[[0,1],[0,-1],[1,0],[-1,0],[1,1],[1,-1],[-1,1],[-1,-1]],
            'K':[[0,1],[0,-1],[1,0],[-1,0],[1,1],[1,-1],[-1,1],[-1,-1]],
            'N':[[2,1],[2,-1],[-2,1],[-2,-1],[1,2],[1,-2],[-1,2],[-1,-2]]
        }[type];
        const lim = (type === 'K' || type === 'N') ? 2 : 16;
        dirs.forEach(([dr, dc]) => {
            for (let i = 1; i < lim; i++) {
                const nr = (r + dr * i + ROWS) % ROWS, nc = (c + dc * i + COLS) % COLS;
                if (board[nr][nc] && board[nr][nc][0] === col) break;
                moves.push({r: nr, c: nc});
                if (board[nr][nc]) break;
            }
        });
    }
    return moves;
}

function draw() {
    canvas.width = window.innerWidth - 300;
    canvas.height = window.innerHeight;
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    for (let r = -2; r < ROWS + 2; r++) {
        for (let c = -2; c < COLS + 2; c++) {
            const rr = (r + ROWS) % ROWS, rc = (c + COLS) % COLS;
            const x = c * CELL + cam.x, y = r * CELL + cam.y;
            
            // Grid
            ctx.fillStyle = (rr + rc) % 2 === 0 ? '#c8c8d2' : '#3c3c55';
            if (r < 0 || r >= ROWS || c < 0 || c >= COLS) ctx.globalAlpha = 0.3;
            else ctx.globalAlpha = 1.0;
            
            if (selected && selected.r === rr && selected.c === rc && r === rr) ctx.fillStyle = '#d4af37';
            ctx.fillRect(x, y, CELL, CELL);
            
            // Pieces
            if (board[rr][rc]) {
                ctx.fillStyle = board[rr][rc][0] === 'w' ? '#fff' : '#000';
                ctx.font = '40px serif';
                ctx.textAlign = 'center';
                ctx.fillText(PIECES[board[rr][rc]], x + CELL/2, y + CELL/2 + 12);
            }
            ctx.globalAlpha = 1.0;
        }
    }
    requestAnimationFrame(draw);
}

canvas.onmousedown = e => {
    if (e.button === 2) isPanning = true;
    else {
        const x = e.offsetX - cam.x, y = e.offsetY - cam.y;
        const c = Math.floor(x / CELL), r = Math.floor(y / CELL);
        const rr = (r + ROWS) % ROWS, rc = (c + COLS) % COLS;
        
        if (selected) {
            const moves = getMoves(selected.r, selected.c);
            if (moves.some(m => m.r === rr && m.c === rc)) {
                if (board[rr][rc][1] === 'K') { gameActive = false; document.getElementById('victory-msg').style.display = 'block'; }
                board[rr][rc] = board[selected.r][selected.c];
                board[selected.r][selected.c] = '';
                turn = turn === 'w' ? 'b' : 'w';
                document.getElementById('turn-label').innerText = `AM ZUG: ${turn === 'w' ? 'WEISS' : 'SCHWARZ'}`;
            }
            selected = null;
        } else if (board[rr][rc] && board[rr][rc][0] === turn) {
            selected = {r: rr, c: rc};
        }
    }
};

window.onmousemove = e => { if (isPanning) { cam.x += e.movementX; cam.y += e.movementY; } };
window.onmouseup = () => isPanning = false;
window.oncontextmenu = e => e.preventDefault();
window.onkeydown = e => { if (e.code === 'Space') cam = {x: 50, y: 50}; };

setInterval(() => {
    if (gameActive) {
        fuel[turn] -= 0.1;
        document.getElementById('fw-val').innerText = Math.ceil(fuel.w);
        document.getElementById('fb-val').innerText = Math.ceil(fuel.b);
        document.getElementById('fw-bar').style.width = (fuel.w/60*100) + '%';
        document.getElementById('fb-bar').style.width = (fuel.b/60*100) + '%';
        if (fuel[turn] <= 0) gameActive = false;
    }
}, 100);

turn = 'w';
initBoard();
draw();
</script>
</body>
</html>
